<?xml version="1.0" encoding="utf-8"?>
<?xml-model href="masic_schema.xsd" type="application/xml" schematypens="http://www.w3.org/2001/XMLSchema"?>
<RenderGraph xmlns="http://www.masicengine.ru">
    <DescriptorAllocators>
        <DescriptorAllocator name="basic_alloc">
            <PageSize>256</PageSize>
        </DescriptorAllocator>
        <DescriptorAllocator name="imgui_alloc">
            <PageSize>8</PageSize>
        </DescriptorAllocator>
    </DescriptorAllocators>
    <Descriptors>
        <DescriptorSet name="basic_diffuse_descriptor_set" allocator="basic_alloc">
            <Layout>
                <LayoutBinding>
                    <Binding>0</Binding>
                    <DescriptorType>uniform_buffer</DescriptorType>
                    <DescriptorCount>1</DescriptorCount>
                    <ShaderStageFlags>
                        <Flag>vertex_bit</Flag>
                    </ShaderStageFlags>
                </LayoutBinding>
                <LayoutBinding>
                    <Binding>1</Binding>
                    <DescriptorType>combined_image_sampler</DescriptorType>
                    <DescriptorCount>1</DescriptorCount>
                    <ShaderStageFlags>
                        <Flag>fragment_bit</Flag>
                    </ShaderStageFlags>
                </LayoutBinding>
            </Layout>
        </DescriptorSet>
        
        <DescriptorSet name="imgui_descriptor_set" allocator="imgui_alloc">
            <Layout>
                <LayoutBinding>
                    <Binding>0</Binding>
                    <DescriptorType>uniform_buffer</DescriptorType>
                    <DescriptorCount>1</DescriptorCount>
                    <ShaderStageFlags>
                        <Flag>vertex_bit</Flag>
                    </ShaderStageFlags>
                </LayoutBinding>
                <LayoutBinding>
                    <Binding>1</Binding>
                    <DescriptorType>combined_image_sampler</DescriptorType>
                    <DescriptorCount>1</DescriptorCount>
                    <ShaderStageFlags>
                        <Flag>fragment_bit</Flag>
                    </ShaderStageFlags>
                </LayoutBinding>
            </Layout>
        </DescriptorSet>
    </Descriptors>

    <Shaders>
        <Shader name="basic_diffuse_vertex_shader">
            <FilePath file_name="shader.vert"></FilePath>
            <EntryPointName>main</EntryPointName>
            <Stage>vertex_bit</Stage>
            <InputAttributeDescription>
                <Binding num="0" input_rate="vertex">
                    <Attribute name="inPosition">
                        <Location>0</Location>
                        <Format>vec3</Format>
                        <Semantic num="0">POSITION</Semantic>
                    </Attribute>
                    <Attribute name="inColor">
                        <Location>1</Location>
                        <Format>vec3</Format>
                        <Semantic num="0">COLOR</Semantic>
                    </Attribute>
                    <Attribute name="inTexCoords">
                        <Location>2</Location>
                        <Format>vec2</Format>
                        <Semantic num="0">TEXCOORD</Semantic>
                    </Attribute>
                </Binding>
            </InputAttributeDescription>
            <DescriptorSet>
                <Set slot="0">basic_diffuse_descriptor_set</Set>
            </DescriptorSet>
        </Shader>
        
        <Shader name="basic_diffuse_pixel_shader">
            <FilePath file_name="shader.frag"></FilePath>
            <EntryPointName>main</EntryPointName>
            <Stage>fragment_bit</Stage>
            <DescriptorSet>
                <Set slot="0">basic_diffuse_descriptor_set</Set>
            </DescriptorSet>
        </Shader>

        <Shader name="imgui_vertex_shader">
            <FilePath file_name="imgui.vert"></FilePath>
            <EntryPointName>main</EntryPointName>
            <Stage>vertex_bit</Stage>
            <InputAttributeDescription>
                <Binding num="0" input_rate="vertex">
                    <Attribute name="inPosition">
                        <Location>0</Location>
                        <Format>vec2</Format>
                        <Semantic num="0">POSITION</Semantic>
                    </Attribute>
                    <Attribute name="inTexCoords">
                        <Location>1</Location>
                        <Format>vec2</Format>
                        <Semantic num="0">TEXCOORD</Semantic>
                    </Attribute>
                    <Attribute name="inColor">
                        <Location>3</Location>
                        <Format>vec3</Format>
                        <Semantic num="0">COLOR</Semantic>
                    </Attribute>
                </Binding>
            </InputAttributeDescription>
            <DescriptorSet>
                <Set slot="0">imgui_descriptor_set</Set>
            </DescriptorSet>
        </Shader>

        <Shader name="imgui_pixel_shader">
            <FilePath file_name="imgui.frag"></FilePath>
            <EntryPointName>main</EntryPointName>
            <Stage>fragment_bit</Stage>
            <DescriptorSet>
                <Set slot="0">imgui_descriptor_set</Set>
            </DescriptorSet>
        </Shader>
    </Shaders>

    <Pipelines>
        <GraphicsPipeline name="basic_diffuse_pipeline">
            <Shaders>
                <Shader>basic_diffuse_vertex_shader</Shader>
                <Shader>basic_diffuse_pixel_shader</Shader>
            </Shaders>
            <InputAssembly>
                <Topology>triangle_list</Topology>
                <PrimitiveRestartEnable>true</PrimitiveRestartEnable>
            </InputAssembly>
            <RasterizationState>
                <DepthClampEnable>false</DepthClampEnable>
                <RasterizerDiscardEnable>false</RasterizerDiscardEnable>
                <PolygonMode>fill</PolygonMode>
                <CullMode><Flags><Flag>back</Flag></Flags></CullMode>
                <FrontFace>counter_clockwise</FrontFace>
                <DepthBiasEnable>false</DepthBiasEnable>
                <DepthBiasConstantFactor>0.0</DepthBiasConstantFactor>
                <DepthBiasClamp>0.0</DepthBiasClamp>
                <DepthBiasSlopeFactor>0.0</DepthBiasSlopeFactor>
                <LineWidth>1.0</LineWidth>
            </RasterizationState>
            <MultisampleState>
                <SampleCount>16_bit</SampleCount>
                <SampleShadingEnable>false</SampleShadingEnable>
                <alphaToCoverageEnable>false</alphaToCoverageEnable>
                <alphaToOneEnable>false</alphaToOneEnable>
            </MultisampleState>
            <DepthStencilState>
                <DepthTestEnable>true</DepthTestEnable>
                <DepthWriteEnable>true</DepthWriteEnable>
                <DepthCompareOp>less</DepthCompareOp>
                <DepthBoundsTestEnable>false</DepthBoundsTestEnable>
                <StencilTestEnable>false</StencilTestEnable>
                <MinDepthBounds>0.0</MinDepthBounds>
                <MaxDepthBounds>1.0</MaxDepthBounds>
            </DepthStencilState>
            <ColorBlendState>
                <LogicOpEnable>false</LogicOpEnable>
                <LogicOp>copy</LogicOp>
                <Attachments>
                    <Attachment>
                        <BlendEnable>false</BlendEnable>
                        <SrcColorBlendFactor>one</SrcColorBlendFactor>
                        <DstColorBlendFactor>zero</DstColorBlendFactor>
                        <ColorBlendOp>add</ColorBlendOp>
                        <SrcAlphaBlendFactor>one</SrcAlphaBlendFactor>
                        <DstAlphaBlendFactor>zero</DstAlphaBlendFactor>
                        <AlphaBlendOp>add</AlphaBlendOp>
                        <ColorWriteMask>
                            <Mask>r_bit</Mask>
                            <Mask>g_bit</Mask>
                            <Mask>b_bit</Mask>
                            <Mask>a_bit</Mask>
                        </ColorWriteMask>
                    </Attachment>
                </Attachments>
                <BlendConstant1>0.0</BlendConstant1>
                <BlendConstant2>0.0</BlendConstant2>
                <BlendConstant3>0.0</BlendConstant3>
                <BlendConstant4>0.0</BlendConstant4>
            </ColorBlendState>
            <DynamicState>
                <Dynamic>viewport</Dynamic>
                <Dynamic>scissor</Dynamic>
            </DynamicState>
        </GraphicsPipeline>

        <GraphicsPipeline name="imgui_pipeline">
            <Shaders>
                <Shader>imgui_vertex_shader</Shader>
                <Shader>imgui_pixel_shader</Shader>
            </Shaders>
            <InputAssembly>
                <Topology>triangle_list</Topology>
                <PrimitiveRestartEnable>true</PrimitiveRestartEnable>
            </InputAssembly>
            <RasterizationState>
                <DepthClampEnable>false</DepthClampEnable>
                <RasterizerDiscardEnable>false</RasterizerDiscardEnable>
                <PolygonMode>fill</PolygonMode>
                <CullMode>
                    <Flags>
                        <Flag>none</Flag>
                    </Flags>
                </CullMode>
                <FrontFace>counter_clockwise</FrontFace>
                <DepthBiasEnable>false</DepthBiasEnable>
                <DepthBiasConstantFactor>0.0</DepthBiasConstantFactor>
                <DepthBiasClamp>0.0</DepthBiasClamp>
                <DepthBiasSlopeFactor>0.0</DepthBiasSlopeFactor>
                <LineWidth>1.0</LineWidth>
            </RasterizationState>
            <MultisampleState>
                <SampleCount>16_bit</SampleCount>
                <SampleShadingEnable>false</SampleShadingEnable>
                <alphaToCoverageEnable>false</alphaToCoverageEnable>
                <alphaToOneEnable>false</alphaToOneEnable>
            </MultisampleState>
            <DepthStencilState>
                <DepthTestEnable>false</DepthTestEnable>
                <DepthWriteEnable>false</DepthWriteEnable>
                <DepthCompareOp>less</DepthCompareOp>
                <DepthBoundsTestEnable>false</DepthBoundsTestEnable>
                <StencilTestEnable>false</StencilTestEnable>
                <MinDepthBounds>0.0</MinDepthBounds>
                <MaxDepthBounds>1.0</MaxDepthBounds>
            </DepthStencilState>
            <ColorBlendState>
                <LogicOpEnable>false</LogicOpEnable>
                <LogicOp>copy</LogicOp>
                <Attachments>
                    <Attachment>
                        <BlendEnable>true</BlendEnable>
                        <SrcColorBlendFactor>src_alpha</SrcColorBlendFactor>
                        <DstColorBlendFactor>one_minus_src_alpha</DstColorBlendFactor>
                        <ColorBlendOp>add</ColorBlendOp>
                        <SrcAlphaBlendFactor>src_alpha</SrcAlphaBlendFactor>
                        <DstAlphaBlendFactor>zero</DstAlphaBlendFactor>
                        <AlphaBlendOp>add</AlphaBlendOp>
                        <ColorWriteMask>
                            <Mask>r_bit</Mask>
                            <Mask>g_bit</Mask>
                            <Mask>b_bit</Mask>
                            <Mask>a_bit</Mask>
                        </ColorWriteMask>
                    </Attachment>
                </Attachments>
                <BlendConstant1>0.0</BlendConstant1>
                <BlendConstant2>0.0</BlendConstant2>
                <BlendConstant3>0.0</BlendConstant3>
                <BlendConstant4>0.0</BlendConstant4>
            </ColorBlendState>
            <DynamicState>
                <Dynamic>viewport</Dynamic>
                <Dynamic>scissor</Dynamic>
            </DynamicState>
        </GraphicsPipeline>
    </Pipelines>
</RenderGraph>